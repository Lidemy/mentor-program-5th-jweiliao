<div class="mermaid">
  graph TD
    A[開始] --> B(用戶輸入網址URL);
    B --> C{使用者輸入為短網址};
    C --> |YES|K(提示用戶不能輸入短網址);
    C --> |No|D{查詢資料庫該 URL 是否存在};
    D --> |YES|I;
    D --> |No|E{用戶選擇自定義短碼};
    E --> |Yes|L{短碼是否存在};
    L -----> |Yes|N(提示用戶該短碼已存在);
    L --> |No|H;
    E --> |No|F(根據 ID 計算對應的短碼);
    F --> G{短碼是否存在};
    G --> |Yes|M(查詢資料庫獲得一筆對應 ID 紀錄的 URL);
    M --> F;
    G --> |No|H(更新短碼到資料庫);
    H --> I(返回短網址);
    K --> J;
    N --> J;
    I --> J[結束]
</div>

1. 將長網址 md5 生成 32 位簽名串,分為 4 段, 每段 8 個字節
2. 對這四段循環處理, 取 8 個字節, 將他看成 16 進制串與 0x3fffffff(30位1) 與操作, 即超過 30 位的忽略處理
3. 這 30 位分成 6 段, 每 5 位的數字作為字母表的索引取得特定字符, 依次進行獲得 6 位字符串
4. 總的 md5 串可以獲得 4 個 6 位串,取里面的任意一個就可作為這個長 url 的短 url 地址

產生出來的 ID 有機率產生碰撞，所以必須回到資料庫比對，如果發現短碼已存在，就根據 TYPE 為自定義的網址取一筆記錄，在用它的 ID 做計算。
網址的結構應該盡量簡潔簡短，過於覆雜的網址，特別是那些包含多個參數的網址，可能會給抓取工具帶來麻煩，因為它們可能會產生大量不必要的網址，全都指向您網站上相同或相似的內容。Google bot 可能會因此而消耗大量不必要的頻寬，也可能無法將網站上的所有內容完整編入索引。
產生出來的短網址應該設有效期限，定期回收無人訪問及超過時效的網址，減少因為長期無人使用造成資源的浪費，也能減少經過演算法產出短碼碰撞的機率

參考資料
[短网址(short URL)系统的原理及其实现](https://hufangyun.com/2017/short-url/?hmsr=toutiao.io&utm_medium=toutiao.io&utm_source=toutiao.io)
